<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Solo Mining Calculator</title>
    <meta name="title" content="suttersebastian.com">
    <meta name="description" content="Calculate your chances for finding a valid bitcoin block when using common lottery mining hardware">
    <meta property="og:image" content="/pics/logo.jpg"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" sizes="180x180" href="pics/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="pics/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="pics/favicon-16x16.png">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <style>
        @media (max-width: 700px) {
            .mobile-width {
                width: 100% !important;
            }
        }
    </style>
</head>

<body class="m-5">
    <h1 class="font-weight-bold text-dark">Solo Mining Calculator <small class="text-muted"></small></h1>

    <div class="text-muted mt-4">
        Calculate your chances for finding a valid bitcoin block when using common lottery mining hardware.<br>
        Current (average) hashrate used for calculations is taken from the <a href="https://mempool.space/docs/api/rest#get-hashrate" target="_blank">mempool.space API</a> and is updated locally on each page refresh.
    </div>

    <div class="mt-4"><span class="font-weight-bold text-dark">Current network hashrate: </span><span id="hashrate-target" class="text-muted"></span>&ensp;<span class="text-muted" data-toggle="tooltip" data-placement="bottom" title="Last weeks average hashrate discounts real-time fluctuations while still being up to date"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16"> <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" /><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" /></svg></span></div>

    <div class="mt-4">
        <div id="presets">
            <label for="preset"><strong class="text-dark">Choose from a preset</strong></label>
            <select class="form-control w-25 mobile-width" id="preset">
                <option value="default" selected>None</option>
                <option value="nerdminer">NerdMiner (45 KH/s)</option>
                <option value="u2plus">Antminer U2+ (2 GH/s)</option>
                <option value="marslander">Mars Lander (300 GH/s)</option>
                <option value="t2turbo">Innosilicon T2T  (24 TH/s)</option>
                <option value="s9">Antminer S9 (13.5 TH/s)</option>
                <option value="s19plus">Antminer S19 Plus (99 TH/s)</option>
                <option value="s19pro">Antminer S19 Pro (110 TH/s)</option>
            </select>
        </div>

        <label for="unit" class="font-weight-bold mt-2 text-dark">Select hashrate unit</label>
        <select class="form-control w-25 mobile-width" id="unit">
            <option value="0">Hash (H/s)</option>
            <option value="1">Kilohash (KH/s)</option>
            <option value="2">Megahash (MH/s)</option>
            <option value="3">Gigahash (GH/s)</option>
            <option value="4" selected>Terahash (TH/s)</option>
            <option value="5">Petahash (PH/s)</option>
        </select>

        <label for="local" class="mt-2 font-weight-bold text-dark">Local hashrate</label>
        <input type="number" class="form-control w-25 mobile-width" id="local" min="1" value="" required>

        <label for="uptime" class="mt-2 text-dark"><strong>Uptime</strong> (out of 24 hours)&ensp;<span class="text-muted" data-toggle="tooltip" data-placement="bottom" title="How many hours will your hardware be running each day? (Relevant for e.g. solar miners)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" /><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" /></svg></label></span></label></label>
        <input type="number" class="form-control w-25 mobile-width" id="uptime" value="24" max="24" min="1" required>

        <label for="years" class="mt-2 text-dark"><strong>Time horizon</strong> (years)&ensp;<span class="text-muted" data-toggle="tooltip" data-placement="bottom" title="How long are you (and your mining hardware) going to stay alive? :P"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle"viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" /><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" /></svg></label></span></label>
        <input type="number" class="form-control w-25 mobile-width" id="years" value="10" max="200" min="1" required>

        <label for="factor" class="mt-2 text-dark"><strong>Yearly hashrate increase</strong> (by factor)&ensp;<a class="small font-weight-bold" data-toggle="tooltip" data-placement="bottom" title="Click for more information" href="javascript:$('#explainmodal').modal('show');" style="text-decoration: underline;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" /><path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z" /></svg></a></label>
        <input type="number" class="form-control w-25 mobile-width" id="factor" value="1.41" max="200" min="1" required>
        <div class="custom-control custom-switch mt-2">
            <input type="checkbox" class="custom-control-input" id="disablefactor" checked>
            <label class="custom-control-label text-muted" for="disablefactor">Use hashrate increase factor</label>
        </div>

        <button type="button" id="calculate" class="mt-4 mb-4 btn btn-lg btn-primary font-weight-bold">Calculate</button>
        <button type="button" id="reset" class="mt-4 mb-4 ml-2 btn btn-lg btn-light font-weight-bold text-dark">Reset</button>
    </div>

    <h4 class="mt-4 font-weight-bold text-dark">Your results</h2>

    <table class="table table-hover mt-4" id="results">
        <thead class="thead-dark">
            <tr>
                <th scope="col">Time horizon</th>
                <th scope="col">Chance</th>
                <th scope="col">Percentage</th>
            </tr>
        </thead>
        <tbody class="text-dark">
            <tr>
                <th scope="row">Per block</th>
                <td id="perblock-target1" class="result"></td>
                <td id="perblock-target2" class="result"></td>
            </tr>
            <tr>
                <th scope="row">Per day</th>
                <td id="perday-target1" class="result"></td>
                <td id="perday-target2" class="result"></td>
            </tr>
            <tr>
                <th scope="row">Per year</th>
                <td id="peryear-target1" class="result"></td>
                <td id="peryear-target2" class="result"></td>
            </tr>
            <tr id="liferow">
                <th scope="row">In your lifetime</th>
                <td id="perlife-target1" class="result"></td>
                <td id="perlife-target2" class="result"></td>
            </tr>
        </tbody>
    </table>

    <footer>
        <small class="text-muted">Made with <span style="color: orange;">♥</span> by <a style="color: orange;" href="https://twitter.com/sutterseba" target="_blank">@sutterseba</a> & <a style="color: orange;" href="https://forum.blocktrainer.de/u/skyrmion" target="_blank">@skyrmion</a></small>
    </footer>

    <div class="modal fade" id="errormodal" tabindex="-1" role="dialog" aria-labelledby="error-title" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-dark font-weight-bold" id="error-title">Alert</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="error-target"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark font-weight-bold" data-dismiss="modal">Dismiss</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="explainmodal" tabindex="-1" role="dialog" aria-labelledby="explainmodalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title font-weight-bold text-dark" id="explainmodalLongTital">Using the yearly hashrate increase factor</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-dark">
                    <p>When calculating solo mining chances over a longer period of time, e.g. for more than one year, it would be increasingly
                    inaccurate, and at some point just straight up false, to assume the network hashrate is not changing. Because it is!</p>
                    <p>This calculator aims to factor in a (more or less) realistic estimated growth of the network hashrate. By how much it is going to increase in the future is, of course, pure speculation, which is why you can adjust the yearly growth factor yourself, as you see fit. For example, if you think the network hashrate is going to double every year, you would set a value of 2.</p>
                    <p>If you have no idea where to start, however, we do propose a default value of 1.41, which corresponds to the hashrate doubling every 2 years. This roughly matches the past few years of hashrate data and can also be justified with <a href="https://en.wikipedia.org/wiki/Moore%27s_law" target="_blank">Moore's Law</a>.</p>
                    <p>Of course, if you prefer to use a contant hashrate for your calculations, you can disable this feature entirely.</p>
                    <p>Good luck and happy hashing!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-dark" data-dismiss="modal">Got it</button>
                </div>
            </div>
        </div>
    </div>

    <script>

        const defaults = {
            'preset': 'default',
            'unit': 4,
            'local': '',
            'uptime': 24,
            'years': 10,
            'factor': 1.41
        };
        
        const presetData = {
            'nerdminer': [1, 45],
            'u2plus': [3, 2],
            'marslander': [3, 300],
            's9': [4, 13.5],
            't2turbo': [4, 24],
            's19plus': [4, 99],
            's19pro': [4, 110]
        };

        var hashrate = 0;

        $(function () {

            $('#errormodal').modal({show: false})
            $('[data-toggle="tooltip"]').tooltip()

            // GET hashrate from mempool.space
            fetch('https://mempool.space/api/v1/mining/hashrate/1m').then(response => {
                if (response.ok) {
                    return response.json();
                }
                else {
                    throw new Error('Request failed with status: ' + response.status);
                }
            }).then(data => {
                // Calculate and save last weeks average hashrate
                $(data.hashrates.slice(-7)).each(function () {
                    hashrate += this.avgHashrate;
                })
                hashrate /= 7;

                $('#hashrate-target').html((hashrate / 10**18).toFixed(4) + ' EH/s');
            });

            $('#calculate').click(function () {

                // Store values from document
                var unit = Math.pow(1000, $('#unit').val());
                var rawlocal = Number($('#local').val());
                var uptime = Number($('#uptime').val());
                var years = Number($('#years').val());
                var factor = Number($('#factor').val());

                if (rawlocal <= 0) {
                    $('#error-title').html('Invalid hashrate');
                    $('#error-target').html('The hashrate value you entered is either invalid or missing.<br>Enter an amount greater than zero.');
                    $('#errormodal').modal('show');
                    return;
                }

                if (years <= 0) {
                    $('#error-title').html('Invalid time horizon')
                    $('#error-target').html('The time horizon you entered is invalid or missing.<br>Enter an amount of years greater than zero.');
                    $('#errormodal').modal('show');
                    return;
                }

                if (uptime <= 0 || uptime > 24) {
                    $('#uptime').val(defaults.uptime);
                    uptime = defaults.uptime;

                    $('#error-title').html('Invalid uptime')
                    $('#error-target').html('The uptime you entered is invalid or missing.<br>Enter an amount between 0 and 24 hours.<br>Defaulted to 24 hours and continued with calculation.');
                    $('#errormodal').modal('show');
                }

                if (factor <= 0) {
                    $('#factor').val(defaults.factor);
                    factor = Math.SQRT2;

                    $('#error-title').html('Invalid hashrate increase')
                    $('#error-target').html('The hashrate growth factor you entered is invalid or missing.<br>Enter a factor greater than zero.<br>Defaulted to 1.41 and continued with calculatoion.');
                    $('#errormodal').modal('show');
                }

                if (factor === 1.41) {
                    factor = Math.SQRT2;
                }

                var local = rawlocal * unit;
                var b = Math.pow(factor, 1 / 52560);
                
                var perblock = calculateChance(local, 1, b);
                var perday = calculateChance(local, 6 * uptime, b);
                var peryear = calculateChance(local, 6 * uptime * 365, b);
                var perlife = calculateChance(local, 6 * uptime * 365 * years, b);

                $('#perblock-target1').html(inChance(perblock));
                $('#perblock-target2').html(formatNumber(perblock));

                $('#perday-target1').html(inChance(perday));
                $('#perday-target2').html(formatNumber(perday));

                $('#peryear-target1').html(inChance(peryear));
                $('#peryear-target2').html(formatNumber(peryear));
                
                $('#perlife-target1').html(inChance(perlife));
                $('#perlife-target2').html(formatNumber(perlife));

                // Set table color based on result
                document.getElementById('liferow').classList = perlife < 1 ? ['table-danger'] : perlife > 50 ? ['table-success'] : ['table-warning'];

                window.scrollTo({left: 0, top: document.body.scrollHeight, behavior: "smooth"});
            });

            $('#reset').click(resetAll);

            $('#preset').change(function (event) {
                const selected = presetData[event.target.value];
                $('#unit').val(selected[0]);
                $('#local').val(selected[1]);
            });

            $('#disablefactor').change(function (event) {
                // Toggle factor input field and value
                if (!event.target.checked) {
                    $('#factor').val(1);
                    $('#factor').attr('disabled', true);
                }
                else {
                    $('#factor').val(defaults.factor);
                    $('#factor').removeAttr('disabled');
                }
            });
        });

        function calculateChance(local, N, b) {
            if (b === 1) {
                return (- Math.expm1(-(local / hashrate) * N)) * 100;
            }
            return (- Math.expm1(-(local / hashrate) * (1 - Math.pow(b, -N)) / (1 - Math.pow(b, -1)))) * 100;
        }

        function inChance (percentage) {
            if (percentage < 0) {
                return 'N/A';
            }
            if (percentage > 100) {
                percentage = 100;
            }
            return '1 in ' + withDelimiters((1 / (percentage / 100)).toFixed(0));
        }

        function formatNumber (n) {
            return n < 0.0001 ? n.toExponential(4) + ' %' : n.toFixed(4) + ' %';
        }

        function withDelimiters (n) {
            // 1000000000 => 1,000,000,000
            return n.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
        }

        function resetAll () {
            // Restore default values
            $('#preset').val(defaults.preset);
            $('#unit').val(defaults.unit);
            $('#uptime').val(defaults.uptime);
            $('#years').val(defaults.years);
            $('#factor').val(defaults.factor);
            $('#local').val('');
            
            // Reset factor checkbox
            $('#disablefactor').prop('checked', true);
            $('#factor').removeAttr('disabled');

            // Clear result table
            $('#liferow').removeClass();
            $('.result').each(function () {
                $(this).html('');
            });

            // Scroll to top of page
            window.scrollTo({left: 0, top: 0, behavior: "smooth"});
        }
    </script>
</body>
</html>